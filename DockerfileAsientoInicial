# syntax=docker/dockerfile:1
FROM cupercupu/clipspy AS build

#oputput from contabilidad.py
RUN mkdir /templates
RUN mkdir /doc
RUN mkdir /doc/necios-2021
RUN mkdir /doc/_posts
RUN mkdir /doc/_data


#input to contabilidad.py
COPY *.bat                    ./
COPY *.clp                    ./

COPY necios-2021-facts.txt              ./
COPY necios-2021-revisiones.txt         ./
COPY necios-2021-revisiones-cuentas.txt ./


COPY valor-activos.txt            ./
COPY tasas.txt                    ./
COPY contratos.txt                ./
copy cuentas.txt                  ./
copy proveedores.txt              ./
COPY remuneraciones.txt           ./
COPY trabajadores.txt             ./
COPY f29-f22.txt                  ./
COPY salud.txt                    ./
COPY tipos_de_depreciaciones.txt  ./
COPY selecciones-asiento-inicial.txt              ./
COPY accionistas.txt              ./
COPY afc.txt                      ./
COPY afps.txt                     ./
COPY tramos-de-impuesto-unico.txt ./
COPY actividades.txt              ./
COPY 404.html                     ./
COPY asiento_inicial.py              ./
WORKDIR .


RUN ./asiento_inicial.py

FROM jekyll/jekyll 

#Estos son manuales
COPY ./*.markdown         ./
COPY ./contaible.markdown ./
COPY ./empresa.markdown   ./
COPY ./nota.markdown      ./
COPY ./o.markdown         ./
COPY ./assets/            ./assets/


#estos resultan de contabilidad.py
COPY --from=build ./doc/necios-2021/ ./necios-2021/



#EStos markdown son generados pr contabilidad.py
#Este copy a veces falla y hace abortar el proceso
#Ocurre cuando no hay *.markdown que copiar
COPY --from=build ./doc/*.markdown      ./




#Estos son manuales
#En necios-2021 se guardan los archivos que se son referidos 
#dese las paginas del servidor que pone en funcionamiento jekyll
COPY ./_config.yml     ./
COPY ./assets/         ./assets/
COPY ./nota/           ./nota/
COPY ./nota/           ./necios-2021/


WORKDIR ./
VOLUME /doc
